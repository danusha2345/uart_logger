# UART Logger

Пассивный логгер двунаправленного UART-обмена на базе Spotpear RP2350-Core-A. Перехватывает два направления UART (921600 бод) и пишет на SD-карту в бинарном формате.

## Схема подключения

```
  Устройство A                    Устройство B
  ┌──────────┐                    ┌──────────┐
  │       TX ├────────────────────┤ RX       │
  │          │    ┌───────────┐   │          │
  │          │    │  RP2350   │   │          │
  │          ├────┤ GPIO1 (RX)│   │          │
  │          │    │  UART0    │   │          │
  │       RX ├────────────────────┤ TX       │
  │          │    │           │   │          │
  │          │    ├───────────┤   │          │
  │          ├────┤ GPIO5 (RX)│   │          │
  │          │    │  UART1    │   │          │
  └──────────┘    └───────────┘   └──────────┘

  Line A: TX устройства A → подключить к GPIO1
  Line B: TX устройства B → подключить к GPIO5
```

**Важно**: логгер подключается **параллельно** к существующим линиям. Он только слушает (RX), не передаёт.

## Распиновка

### UART (пассивный перехват)

| Сигнал | GPIO | Пин RP2350-Core-A | Подключение |
|--------|------|-------------------|-------------|
| Line A | GPIO1 | Pin 2 | TX устройства A (направление A→B) |
| Line B | GPIO5 | Pin 7 | TX устройства B (направление B→A) |

GPIO0 и GPIO4 (TX) заняты HAL-ом, но физически не подключаются.

### SD-карта (SPI1)

| Сигнал | GPIO | Пин RP2350-Core-A | SD-карта |
|--------|------|-------------------|----------|
| SCK | GPIO10 | Pin 14 | CLK |
| MOSI | GPIO11 | Pin 15 | DI (CMD) |
| MISO | GPIO12 | Pin 16 | DO (DAT0) |
| CS | GPIO13 | Pin 17 | CS (DAT3) |
| 3.3V | — | 3V3 | VCC |
| GND | — | GND | GND |

### LED (WS2812B)

| Сигнал | GPIO | Пин RP2350-Core-A |
|--------|------|-------------------|
| DIN | GPIO16 | Pin 21 |

Встроенный на плате Spotpear RP2350-Core-A.

## LED индикация

| Цвет | Паттерн | Значение |
|------|---------|----------|
| Синий | Быстрое мигание | Инициализация |
| Красный | Медленное мигание | Ошибка SD-карты |
| Зелёный | Горит постоянно | Запись |
| Жёлтый | Мигание | Переполнение буфера (потеря пакетов) |

## Бинарный формат записи

Файлы: `LOG_0001.BIN`, `LOG_0002.BIN`, ... (автонумерация)

Каждая запись:

```
Offset  Size  Описание
0       1     Direction: 0x00 = Line A, 0x01 = Line B
1       4     Timestamp (мс от старта, little-endian)
5       2     Length (длина данных, little-endian)
7       N     Data (до 256 байт)
```

Пример (hexdump):
```
00 2A 00 00 00 05 00 48 65 6C 6C 6F    Line A, ts=42ms, 5 bytes: "Hello"
01 30 00 00 00 02 00 4F 4B              Line B, ts=48ms, 2 bytes: "OK"
```

## Сборка и прошивка

```bash
cargo build --release
cargo run --release      # прошивка через probe-rs
```

Требуется: Rust nightly, `probe-rs`, подключение через SWD.

## Подготовка SD-карты

- Формат: FAT32
- Размер: любой (тестировалось на 2-32 GB)
- Вставить карту **до** включения питания
